#######################Practica #1#######################

Cifrado con GPG

Instalamos GPG2

sudo apt install gnupg2

Generamos las claves

gpg2 --full-generate-key

Creamos un directorio, y dentro de este un archivo

mkdir ~/Desktop/Prueba
echo "Texto para probar el cifrado GPG2" > ~/Desktop/Prueba/Archivo1.txt

Ciframos el archivo

gpg2 -e -r "ID" ~/Desktop/Prueba/Archivo1.txt

Intentamos acceder al archivo

cat ~/Desktop/Prueba/Archivo1.txt.gpg

Desciframos el archivo

gpg2 -d ~/Desktop/Prueba/Archivo1.txt.gpg > Archivo2.txt

Verificamos la integridad del archivo

cat Archivo2.txt

#########################################################

#######################Practica #2#######################

Verificamos los servicios desde un cliente Externo

Bloqueamos trafico entrante hacia puertos 21, 22 y 80 con IPTables

sudo iptables -A INPUT -p tcp --dport 21 -j DROP
sudo iptables -A INPUT -p tcp --dport 22 -j DROP
sudo iptables -A INPUT -p tcp --dport 80 -j DROP

Probamos el acceso desde un cliente externo

Liberamos las reglas

sudo iptables -D INPUT -p tcp --dport 21 -j DROP
sudo iptables -D INPUT -p tcp --dport 22 -j DROP
sudo iptables -D INPUT -p tcp --dport 80 -j DROP

Probamos acceso desde cliente externo

Bloqueamos el trafico entrante hacia puertos 21, 22 y 80 con UFW (Debian Based)

ufw deny 21
ufw deny 22
ufw deny 80

Probamos acceso desde cliente externo

Liberamos reglas 

ufw delete deny 21
ufw delete deny 22
ufw delete deny 80

#########################################################

#######################Practica #3#######################



#########################################################

#######################Practica #4#######################

1. Instalaci贸n de Google Authenticator en Ubuntu

sudo apt update
sudo apt install libpam-google-authenticator -y

2. Configuraci贸n para el Usuario

    Ejecutar el asistente de configuraci贸n (como usuario normal, NO root):

    google-authenticator

    Seguir las instrucciones interactivas:

        驴Generar tokens basados en tiempo? (S铆)

        Guardar el c贸digo de emergencia (en un lugar seguro)

        驴Actualizar el archivo ~/.google_authenticator? (S铆)

        驴Permitir m煤ltiples usos del mismo c贸digo? (No, por seguridad)

        驴Limitar ventana de verificaci贸n? (S铆)

        驴Habilitar protecci贸n contra fuerza bruta? (S铆)

    Configurar el c贸digo QR en Google Authenticator (app m贸vil):

        Escanear el QR mostrado en terminal.

        O ingresar manualmente la clave secreta.

3. Configurar PAM para usar Google Authenticator

    Editar el archivo PAM para SSH:

sudo nano /etc/pam.d/sshd

Agregar al inicio del archivo:

auth required pam_google_authenticator.so

Comentar (si existe) la l铆nea:

    @include common-auth

    (para evitar doble solicitud de contrase帽a).

4. Configurar SSH para usar 2FA

    Editar la configuraci贸n de SSH:

sudo nano /etc/ssh/sshd_config

Asegurar estas l铆neas est茅n as铆:
plaintext

ChallengeResponseAuthentication yes
UsePAM yes
PasswordAuthentication yes  # (Si usas contrase帽a + 2FA)

Reiniciar SSH:

    sudo systemctl restart sshd

5. Probamos desde un cliente externo

ssh usuario@[IP_de_tu_VM]

    Secuencia de autenticaci贸n:

        Ingresar contrase帽a.

        Ingresar c贸digo de 6 d铆gitos (app m贸vil).

6. Soluci贸n de Problemas Comunes
 Error: "Permission denied (keyboard-interactive)"

    Verifica que en /etc/ssh/sshd_config est茅:
    plaintext

    ChallengeResponseAuthentication yes
    UsePAM yes

 No se solicita el c贸digo 2FA

    Revisa que /etc/pam.d/sshd tenga:
    plaintext

    auth required pam_google_authenticator.so

 C贸digo no funciona

    Verifica sincronizaci贸n de tiempo en la VM:

    sudo apt install ntpdate
    sudo ntpdate pool.ntp.org

7. Desactivar 2FA (Opcional)

    Eliminar el archivo de configuraci贸n:

rm ~/.google_authenticator

Revertir cambios en PAM:

sudo nano /etc/pam.d/sshd

    Eliminar pam_google_authenticator.so.

    Descomentar @include common-auth.

Reiniciar SSH:

sudo systemctl restart sshd

#########################################################
