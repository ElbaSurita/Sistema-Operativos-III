#######################Practica #1#######################

Cifrado con GPG

Instalamos GPG2

sudo apt install gnupg2

Generamos las claves

gpg2 --full-generate-key

Creamos un directorio, y dentro de este un archivo

mkdir ~/Desktop/Prueba
echo "Texto para probar el cifrado GPG2" > ~/Desktop/Prueba/Archivo1.txt

Ciframos el archivo

gpg2 -e -r "ID" ~/Desktop/Prueba/Archivo1.txt

Intentamos acceder al archivo

cat ~/Desktop/Prueba/Archivo1.txt.gpg

Desciframos el archivo

gpg2 -d ~/Desktop/Prueba/Archivo1.txt.gpg > Archivo2.txt

Verificamos la integridad del archivo

cat Archivo2.txt

#########################################################

#######################Practica #2#######################

Verificamos los servicios desde un cliente Externo

Bloqueamos trafico entrante hacia puertos 21, 22 y 80 con IPTables

sudo iptables -A INPUT -p tcp --dport 21 -j DROP
sudo iptables -A INPUT -p tcp --dport 22 -j DROP
sudo iptables -A INPUT -p tcp --dport 80 -j DROP

Probamos el acceso desde un cliente externo

Liberamos las reglas

sudo iptables -D INPUT -p tcp --dport 21 -j DROP
sudo iptables -D INPUT -p tcp --dport 22 -j DROP
sudo iptables -D INPUT -p tcp --dport 80 -j DROP

Probamos acceso desde cliente externo

Bloqueamos el trafico entrante hacia puertos 21, 22 y 80 con UFW (Debian Based)

ufw deny 21
ufw deny 22
ufw deny 80

Probamos acceso desde cliente externo

Liberamos reglas 

ufw delete deny 21
ufw delete deny 22
ufw delete deny 80

#########################################################

#######################Practica #3#######################

practica 3 

1. Instalaci贸n de Snort en Ubuntu
bash

# Actualizar e instalar dependencias
sudo apt update
sudo apt install -y snort libpcap-dev

# Verificar versi贸n
snort -V

2. Configuraci贸n B谩sica de Snort
bash

# Editar configuraci贸n principal
sudo nano /etc/snort/snort.conf

# Modificar estas l铆neas:
var HOME_NET [IP_de_tu_VM]/32   # Ej: 192.168.1.100/32
var EXTERNAL_NET any
ipvar DNS_SERVERS $HOME_NET

3. Creaci贸n de Reglas de Detecci贸n
bash

# Crear archivo de reglas locales
sudo nano /etc/snort/rules/local.rules

Agregar las siguientes reglas:
plaintext

# Detecci贸n de ICMP (Ping)
alert icmp any any -> $HOME_NET any (msg:"ICMP Ping Detectado"; sid:1000001; rev:1;)

# Detecci贸n de tr谩fico FTP (puerto 21)
alert tcp any any -> $HOME_NET 21 (msg:"Tr谩fico FTP Detectado"; sid:1000002; rev:1;)

# Detecci贸n de tr谩fico SSH (puerto 22)
alert tcp any any -> $HOME_NET 22 (msg:"Tr谩fico SSH Detectado"; sid:1000003; rev:1;)

# Detecci贸n de tr谩fico HTTP (puerto 80)
alert tcp any any -> $HOME_NET 80 (msg:"Tr谩fico HTTP Detectado"; sid:1000004; rev:1;)

4. Ejecuci贸n de Snort en Modo IDS
bash

# Verificar configuraci贸n
sudo snort -T -c /etc/snort/snort.conf

# Ejecutar en modo IDS (reemplaza 'eth0' con tu interfaz de red)
sudo snort -A console -q -c /etc/snort/snort.conf -i eth0 -l /var/log/snort/

5. Pruebas desde Windows 11
Prueba 1: Detecci贸n de Ping (ICMP)
powershell

# En Windows (PowerShell o CMD):
ping [IP_de_VM]

Salida esperada en Snort:
text

[**] [1:1000001:1] ICMP Ping Detectado [**]
[Priority: 0] 
{ICMP} 192.168.1.50 -> 192.168.1.100

Prueba 2: Detecci贸n de FTP (Puerto 21)
powershell

# Usar telnet para probar conexi贸n FTP
telnet [IP_de_VM] 21

Salida esperada en Snort:
text

[**] [1:1000002:1] Tr谩fico FTP Detectado [**]
[Priority: 0] 
{TCP} 192.168.1.50:51234 -> 192.168.1.100:21

Prueba 3: Detecci贸n de SSH (Puerto 22)
powershell

# Usar telnet para probar conexi贸n SSH
telnet [IP_de_VM] 22

Salida esperada en Snort:
text

[**] [1:1000003:1] Tr谩fico SSH Detectado [**]
[Priority: 0] 
{TCP} 192.168.1.50:51235 -> 192.168.1.100:22

Prueba 4: Detecci贸n de HTTP (Puerto 80)
powershell

# Usar curl o navegador web
curl http://[IP_de_VM]

Salida esperada en Snort:
text

[**] [1:1000004:1] Tr谩fico HTTP Detectado [**]
[Priority: 0] 
{TCP} 192.168.1.50:51236 -> 192.168.1.100:80

6. Visualizaci贸n de Alertas
bash

# Ver alertas en tiempo real (en otra terminal)
sudo tail -f /var/log/snort/alert

7. Detener Snort
bash

# Para detener Snort
sudo pkill snort

Resumen de Configuraci贸n
Protocolo	Puerto	Regla Snort	Prueba Windows
ICMP	-	alert icmp any any -> $HOME_NET any	ping [IP]
FTP	21	alert tcp any any -> $HOME_NET 21	telnet [IP] 21
SSH	22	alert tcp any any -> $HOME_NET 22	telnet [IP] 22
HTTP	80	alert tcp any any -> $HOME_NET 80	curl http://[IP]

Consejos:

    Aseg煤rate que los servicios (FTP/SSH/HTTP) est谩n corriendo en Ubuntu

    Verifica que no hay reglas de firewall bloqueando el tr谩fico

    Para pruebas m谩s reales, puedes usar Nmap desde Windows:
    powershell

nmap -p 21,22,80 [IP_de_VM]

#########################################################

#######################Practica #4#######################

1. Instalaci贸n de Google Authenticator en Ubuntu

sudo apt update
sudo apt install libpam-google-authenticator -y

2. Configuraci贸n para el Usuario

    Ejecutar el asistente de configuraci贸n (como usuario normal, NO root):

    google-authenticator

    Seguir las instrucciones interactivas:

        驴Generar tokens basados en tiempo? (S铆)

        Guardar el c贸digo de emergencia (en un lugar seguro)

        驴Actualizar el archivo ~/.google_authenticator? (S铆)

        驴Permitir m煤ltiples usos del mismo c贸digo? (No, por seguridad)

        驴Limitar ventana de verificaci贸n? (S铆)

        驴Habilitar protecci贸n contra fuerza bruta? (S铆)

    Configurar el c贸digo QR en Google Authenticator (app m贸vil):

        Escanear el QR mostrado en terminal.

        O ingresar manualmente la clave secreta.

3. Configurar PAM para usar Google Authenticator

    Editar el archivo PAM para SSH:

sudo nano /etc/pam.d/sshd

Agregar al inicio del archivo:

auth required pam_google_authenticator.so

Comentar (si existe) la l铆nea:

    @include common-auth

    (para evitar doble solicitud de contrase帽a).

4. Configurar SSH para usar 2FA

    Editar la configuraci贸n de SSH:

sudo nano /etc/ssh/sshd_config

Asegurar estas l铆neas est茅n as铆:
plaintext

ChallengeResponseAuthentication yes
UsePAM yes
PasswordAuthentication yes  # (Si usas contrase帽a + 2FA)

Reiniciar SSH:

    sudo systemctl restart sshd

5. Probamos desde un cliente externo

ssh usuario@[IP_de_tu_VM]

    Secuencia de autenticaci贸n:

        Ingresar contrase帽a.

        Ingresar c贸digo de 6 d铆gitos (app m贸vil).

6. Soluci贸n de Problemas Comunes
 Error: "Permission denied (keyboard-interactive)"

    Verifica que en /etc/ssh/sshd_config est茅:
    plaintext

    ChallengeResponseAuthentication yes
    UsePAM yes

 No se solicita el c贸digo 2FA

    Revisa que /etc/pam.d/sshd tenga:
    plaintext

    auth required pam_google_authenticator.so

 C贸digo no funciona

    Verifica sincronizaci贸n de tiempo en la VM:

    sudo apt install ntpdate
    sudo ntpdate pool.ntp.org

7. Desactivar 2FA (Opcional)

    Eliminar el archivo de configuraci贸n:

rm ~/.google_authenticator

Revertir cambios en PAM:

sudo nano /etc/pam.d/sshd

    Eliminar pam_google_authenticator.so.

    Descomentar @include common-auth.

Reiniciar SSH:

sudo systemctl restart sshd

#########################################################
